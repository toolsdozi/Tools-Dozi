<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elite PDF Toolkit</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-gradient: linear-gradient(90deg, #FDBB2D 0%, #D4AF37 50%, #B8860B 100%);
      --background-start: #0F0C29;
      --background-mid: #302B63;
      --background-end: #24243E;
      --surface-color: rgba(26, 26, 42, 0.75);
      --text-color: #E0E0E0;
      --text-muted-color: #A0A0A0;
      --border-color: rgba(255, 215, 0, 0.2);
      --danger-color: #ff5252;
      --success-color: #00C851;
      --border-radius: 16px;
      --box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      color: var(--text-color);
      background: linear-gradient(-45deg, var(--background-start), var(--background-mid), var(--background-end), var(--background-start));
      background-size: 400% 400%;
      animation: gradientBG 20s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 1rem;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .toolkit-container {
      max-width: 650px;
      width: 100%;
      background: var(--surface-color);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      border: 1px solid var(--border-color);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .tabs {
      display: flex;
      background-color: rgba(0, 0, 0, 0.2);
    }

    .tab-button {
      flex: 1;
      padding: 1rem;
      font-size: 1.1rem;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      border: none;
      background: none;
      color: var(--text-muted-color);
      transition: all 0.3s ease;
      position: relative;
    }
    
    .tab-button::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 3px;
        background: var(--primary-gradient);
        transition: width 0.3s ease;
    }

    .tab-button.active {
      color: #FDBB2D;
    }

    .tab-button.active::after {
        width: 60%;
    }

    .tab-content {
      padding: 2.5rem;
    }

    .tool-section { display: none; }
    .tool-section.active { display: block; animation: fadeIn 0.5s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .tool-section h2 {
        text-align: center;
        margin-top: 0;
        margin-bottom: 2rem;
        font-weight: 700;
        font-size: 1.8rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .upload-area {
      border: 2px dashed var(--border-color);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background-color: rgba(0,0,0,0.1);
    }

    .upload-area.drag-over {
      border-color: #FDBB2D;
      box-shadow: 0 0 15px rgba(253, 187, 45, 0.3);
      background-color: rgba(253, 187, 45, 0.05);
    }
    
    .upload-area p { margin: 0.5rem 0; }
    .upload-area strong { font-weight: 500; color: #FDBB2D; }

    input[type="file"] { display: none; }

    #merge-file-list, #split-file-name { margin-top: 1.5rem; }
    
    .file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: rgba(0,0,0,0.2);
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        animation: fadeIn 0.3s ease;
    }

    .remove-file-btn {
        cursor: pointer;
        color: var(--text-muted-color);
        border: none;
        background: none;
        font-size: 1.2rem;
        transition: color 0.3s ease;
    }
    .remove-file-btn:hover { color: var(--danger-color); }
    
    .input-group input[type="text"] {
        width: 100%;
        margin-top: 1.5rem;
        padding: 0.85rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 1rem;
        background-color: rgba(0,0,0,0.2);
        color: var(--text-color);
        transition: all 0.3s ease;
    }
    .input-group input[type="text"]:focus {
        border-color: #FDBB2D;
        box-shadow: 0 0 10px rgba(253, 187, 45, 0.3);
        outline: none;
    }

    .button {
      background: var(--primary-gradient);
      color: #111;
      border: none;
      padding: 0.9rem 2rem;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      display: block;
      width: 100%;
      margin-top: 2rem;
      transition: all 0.3s ease;
      background-size: 200% auto;
    }

    .button:hover:not(:disabled) {
      background-position: right center;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
    }
    
    .button:disabled {
      background: #444;
      color: #888;
      cursor: not-allowed;
    }

    .processing-area, .results-area { text-align: center; padding: 3rem 0; animation: fadeIn 0.5s ease; }
    
    .loader {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: inline-block;
        border-top: 3px solid #FDBB2D;
        border-right: 3px solid transparent;
        box-sizing: border-box;
        animation: spin 1s linear infinite;
        margin: 0 auto 1.5rem auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .results-area h3 {
        color: var(--success-color);
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
    }
    
    .button.secondary {
        background: none;
        border: 2px solid var(--text-muted-color);
        color: var(--text-muted-color);
        font-weight: 500;
    }
    
    .button.secondary:hover {
        background-color: var(--text-muted-color);
        color: #111;
        box-shadow: none;
        transform: translateY(0);
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="toolkit-container">
    <div class="tabs">
      <button class="tab-button active" data-tab="merge">Merge</button>
      <button class="tab-button" data-tab="split">Split</button>
    </div>

    <div class="tab-content">
      <div id="initialState">
        <div id="merge" class="tool-section active">
          <h2>Merge PDF Files</h2>
          <label for="mergeInput" class="upload-area" id="mergeUploadArea">
            <p>Drag & Drop Your PDFs Here</p>
            <p>or <strong>Browse Files</strong></p>
          </label>
          <input type="file" id="mergeInput" accept="application/pdf" multiple />
          <div id="merge-file-list"></div>
          <button class="button" id="mergeBtn" disabled>Merge PDFs</button>
        </div>

        <div id="split" class="tool-section">
          <h2>Split Your PDF</h2>
          <label for="splitInput" class="upload-area" id="splitUploadArea">
            <p>Drag & Drop a PDF Here</p>
            <p>or <strong>Browse File</strong></p>
          </label>
          <input type="file" id="splitInput" accept="application/pdf" />
          <div id="split-file-name"></div>
          <div class="input-group">
            <input type="text" id="splitPages" placeholder="Enter pages, e.g., 1, 3-5, 8" />
          </div>
          <button class="button" id="splitBtn" disabled>Split PDF</button>
        </div>
      </div>

      <div id="processingState" class="hidden">
        <div class="processing-area">
          <div class="loader"></div>
          <p id="processingText">Processing your files...</p>
        </div>
      </div>

      <div id="resultsState" class="hidden">
        <div class="results-area">
          <h3>Success!</h3>
          <p id="resultsText">Your file is ready.</p>
          <a id="downloadLink" class="button" download>Download File</a>
          <button id="resetBtn" class="button secondary">Process Another File</button>
        </div>
      </div>

    </div>
  </div>

  <script type="module">
    // All JavaScript is the same as the previous version, as requested.
    // It controls the functionality which remains unchanged.
    import { PDFDocument } from 'https://cdn.skypack.dev/pdf-lib';

    const initialState = document.getElementById('initialState');
    const processingState = document.getElementById('processingState');
    const resultsState = document.getElementById('resultsState');
    const tabs = document.querySelectorAll('.tab-button');
    const toolSections = document.querySelectorAll('.tool-section');
    const mergeInput = document.getElementById('mergeInput');
    const mergeUploadArea = document.getElementById('mergeUploadArea');
    const mergeFileList = document.getElementById('merge-file-list');
    const mergeBtn = document.getElementById('mergeBtn');
    const splitInput = document.getElementById('splitInput');
    const splitUploadArea = document.getElementById('splitUploadArea');
    const splitFileName = document.getElementById('split-file-name');
    const splitPages = document.getElementById('splitPages');
    const splitBtn = document.getElementById('splitBtn');
    const downloadLink = document.getElementById('downloadLink');
    const resetBtn = document.getElementById('resetBtn');
    const processingText = document.getElementById('processingText');
    let mergeFiles = [];
    let splitFile;

    function switchTab(tab) {
      tabs.forEach(t => t.classList.remove('active'));
      toolSections.forEach(s => s.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
    }

    tabs.forEach(tab => tab.addEventListener('click', () => switchTab(tab)));

    function showState(state, message = '') {
      initialState.classList.add('hidden');
      processingState.classList.add('hidden');
      resultsState.classList.add('hidden');
      if (state === 'initial') initialState.classList.remove('hidden');
      else if (state === 'processing') {
        processingText.textContent = message;
        processingState.classList.remove('hidden');
      } else if (state === 'results') resultsState.classList.remove('hidden');
    }

    function resetUI() {
      mergeFiles = [];
      splitFile = null;
      mergeInput.value = '';
      splitInput.value = '';
      splitPages.value = '';
      renderMergeFileList();
      renderSplitFileName();
      if(downloadLink.href) URL.revokeObjectURL(downloadLink.href);
      showState('initial');
    }

    resetBtn.addEventListener('click', resetUI);

    function setupDragDrop(uploadArea, onDrop) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => uploadArea.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); }, false));
        ['dragenter', 'dragover'].forEach(eventName => uploadArea.addEventListener(eventName, () => uploadArea.classList.add('drag-over'), false));
        ['dragleave', 'drop'].forEach(eventName => uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('drag-over'), false));
        uploadArea.addEventListener('drop', e => onDrop(e.dataTransfer.files), false);
    }
    
    setupDragDrop(mergeUploadArea, files => handleMergeFiles(Array.from(files)));
    setupDragDrop(splitUploadArea, files => handleSplitFile(files[0]));

    mergeInput.addEventListener('change', (e) => handleMergeFiles(Array.from(e.target.files)));
    mergeBtn.addEventListener('click', mergePDFs);

    function handleMergeFiles(files) {
        const pdfFiles = files.filter(f => f.type === 'application/pdf');
        mergeFiles.push(...pdfFiles);
        renderMergeFileList();
    }
    
    function renderMergeFileList() {
        mergeFileList.innerHTML = '';
        mergeFiles.forEach((file, index) => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `<span>${file.name}</span><button class="remove-file-btn" data-index="${index}">&times;</button>`;
            mergeFileList.appendChild(fileItem);
        });
        document.querySelectorAll('.remove-file-btn').forEach(btn => btn.addEventListener('click', (e) => {
            mergeFiles.splice(e.target.dataset.index, 1);
            renderMergeFileList();
        }));
        mergeBtn.disabled = mergeFiles.length < 2;
    }

    async function mergePDFs() {
        showState('processing', 'Merging your PDFs...');
        try {
            const mergedPdf = await PDFDocument.create();
            for (const file of mergeFiles) {
                const bytes = await file.arrayBuffer();
                const pdf = await PDFDocument.load(bytes, { ignoreEncryption: true });
                const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                copiedPages.forEach(page => mergedPdf.addPage(page));
            }
            const mergedBytes = await mergedPdf.save();
            displayResult(mergedBytes, 'merged.pdf');
        } catch (error) {
            alert('An error occurred while merging. One of the PDFs might be corrupted or password-protected.');
            console.error(error);
            resetUI();
        }
    }

    splitInput.addEventListener('change', (e) => handleSplitFile(e.target.files[0]));
    splitBtn.addEventListener('click', splitPDF);

    function handleSplitFile(file) {
        if (file && file.type === 'application/pdf') {
            splitFile = file;
            renderSplitFileName();
        } else if(file) {
            alert('Please select a valid PDF file.');
        }
    }

    function renderSplitFileName() {
        splitFileName.innerHTML = '';
        if (splitFile) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `<span>${splitFile.name}</span>`;
            splitFileName.appendChild(fileItem);
        }
        splitBtn.disabled = !splitFile;
    }
    
    async function splitPDF() {
        if (!splitPages.value.trim()) {
            alert('Please enter page numbers or ranges to split.');
            return;
        }
        showState('processing', 'Splitting your PDF...');
        try {
            const bytes = await splitFile.arrayBuffer();
            const pdfDoc = await PDFDocument.load(bytes, { ignoreEncryption: true });
            const pageIndices = parsePageInput(splitPages.value, pdfDoc.getPageCount());
            if (pageIndices.length === 0) {
              alert('Invalid page numbers or range. Please check your input and the PDF page count.');
              showState('initial');
              return;
            }
            const splitPdf = await PDFDocument.create();
            const pages = await splitPdf.copyPages(pdfDoc, pageIndices);
            pages.forEach((page) => splitPdf.addPage(page));
            const splitBytes = await splitPdf.save();
            displayResult(splitBytes, 'split.pdf');
        } catch (error) {
            alert('An error occurred while splitting. The PDF might be corrupted or password-protected.');
            console.error(error);
            resetUI();
        }
    }

    function parsePageInput(input, maxPages) {
      const indices = new Set();
      const parts = input.split(',');
      for (const part of parts) {
        const trimmedPart = part.trim();
        if (trimmedPart.includes('-')) {
          let [start, end] = trimmedPart.split('-').map(num => parseInt(num, 10));
          if (!isNaN(start) && !isNaN(end)) {
            start = Math.max(1, start);
            end = Math.min(maxPages, end);
            for (let i = start; i <= end; i++) indices.add(i - 1);
          }
        } else {
          const pageNum = parseInt(trimmedPart, 10);
          if (!isNaN(pageNum) && pageNum >= 1 && pageNum <= maxPages) indices.add(pageNum - 1);
        }
      }
      return Array.from(indices).sort((a, b) => a - b);
    }
    
    function displayResult(bytes, filename) {
        const blob = new Blob([bytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        downloadLink.href = url;
        downloadLink.download = filename;
        showState('results');
    }
  </script>
</body>
</html>
