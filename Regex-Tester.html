<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Advanced Regex Tester</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
  <style>
    :root {
      --border-radius: 12px;
      --transition-speed: 0.3s;
      --font-main: 'Inter', sans-serif;
      --font-mono: 'Roboto Mono', monospace;
    }

    :root[data-theme='dark'] {
      --bg-start: #0F0C29; --bg-mid: #302B63; --bg-end: #24243E;
      --surface-color: rgba(30, 30, 42, 0.85);
      --border-color: rgba(255, 255, 255, 0.1);
      --primary-text-color: #F0F0F0;
      --secondary-text-color: #A0A0A0;
      --accent-color: #8E2DE2;
      --accent-glow-color: rgba(142, 45, 226, 0.3);
      --shadow-color: rgba(0,0,0,0.5);
      --input-bg-color: rgba(0,0,0,0.3);
      --highlight-bg: rgba(142, 45, 226, 0.4);
      --error-bg: rgba(255, 82, 82, 0.1);
      --error-border: #ff5252;
    }

    :root[data-theme='light'] {
      --bg-start: #FDFBFB; --bg-mid: #EBEDEE; --bg-end: #FDFBFB;
      --surface-color: rgba(255, 255, 255, 0.9);
      --border-color: rgba(0, 0, 0, 0.1);
      --primary-text-color: #111;
      --secondary-text-color: #666;
      --accent-color: #4A00E0;
      --accent-glow-color: rgba(74, 0, 224, 0.2);
      --shadow-color: rgba(0,0,0,0.1);
      --input-bg-color: rgba(0,0,0,0.03);
      --highlight-bg: rgba(74, 0, 224, 0.2);
      --error-bg: rgba(255, 68, 68, 0.1);
      --error-border: #ff4444;
    }
    
    * { box-sizing: border-box; margin: 0; }
    body {
      font-family: var(--font-main);
      background: linear-gradient(-45deg, var(--bg-start), var(--bg-mid), var(--bg-end));
      background-size: 400% 400%; animation: gradientBG 15s ease infinite;
      color: var(--primary-text-color); display: flex; justify-content: center;
      align-items: center; min-height: 100vh; padding: 1.5rem;
    }
    @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

    .container {
      width: 100%; max-width: 900px;
      background: var(--surface-color); backdrop-filter: blur(25px);
      border: 1px solid var(--border-color); border-radius: 20px;
      padding: 2rem; box-shadow: 0 20px 60px var(--shadow-color);
    }
    
    h1 { text-align: center; margin-bottom: 2rem; }

    .regex-controls { display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem; }
    .regex-input-wrapper { flex: 1; position: relative; }
    .regex-input {
      width: 100%; padding: 0.75rem 3rem 0.75rem 2.5rem; border-radius: 8px;
      background: var(--input-bg-color); color: var(--primary-text-color);
      border: 1px solid var(--border-color); font-family: var(--font-mono); font-size: 1rem;
      outline: none; transition: all var(--transition-speed);
    }
    .regex-input:focus { border-color: var(--accent-color); box-shadow: 0 0 10px var(--accent-glow-color); }
    .regex-input-wrapper::before {
        content: "/"; position: absolute; left: 1rem; top: 50%;
        transform: translateY(-50%); color: var(--secondary-text-color);
    }
     .regex-input-wrapper::after {
        content: "/"; position: absolute; right: 1rem; top: 50%;
        transform: translateY(-50%); color: var(--secondary-text-color);
    }

    .regex-flags { display: flex; gap: 0.75rem; }
    .flag-label { cursor: pointer; user-select: none; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 6px; transition: all var(--transition-speed); }
    .flag-label:hover { background: var(--input-bg-color); }
    .flag-label.active { background: var(--accent-color); color: white; border-color: var(--accent-color); }
    .flag-checkbox { display: none; }

    .editor-wrapper { position: relative; height: 250px; margin-bottom: 1rem; }
    .editor-textarea, .editor-highlight {
      width: 100%; height: 100%; padding: 1rem; margin: 0;
      border: 1px solid var(--border-color); border-radius: 8px;
      font-family: var(--font-mono); font-size: 1rem; line-height: 1.5;
      background: none;
    }
    .editor-textarea { position: relative; z-index: 2; color: inherit; resize: vertical; overflow: auto; background-color: transparent; }
    .editor-highlight { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none; white-space: pre-wrap; word-wrap: break-word; overflow: hidden; background: var(--input-bg-color); }
    .editor-highlight mark { color: inherit; background: var(--highlight-bg); border-radius: 3px; }

    .results-panel {
      min-height: 150px; max-height: 300px; overflow-y: auto; padding: 1rem;
      background: var(--input-bg-color); border-radius: 8px;
    }
    .results-header { margin-bottom: 1rem; color: var(--secondary-text-color); }
    .match-item { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
    .match-item:last-child { border-bottom: none; }
    .match-title { font-weight: bold; }
    .match-group { margin-left: 1.5rem; margin-top: 0.5rem; }
    .error-message { color: var(--error-border); font-family: var(--font-mono); }
    
    .cheatsheet details { margin-top: 2rem; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem; }
    .cheatsheet summary { cursor: pointer; font-weight: bold; }
    .cheatsheet-content { margin-top: 1rem; font-family: var(--font-mono); font-size: 0.9rem; }
    
    @media (max-width: 768px) {
      .container { padding: 1.5rem; }
      .regex-controls { flex-direction: column; align-items: stretch; }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Regex Tester</h1>

    <div class="regex-controls">
      <div class="regex-input-wrapper">
        <input type="text" id="regex-input" placeholder="Enter your pattern here">
      </div>
      <div class="regex-flags" id="regex-flags">
        <label class="flag-label active" data-flag="g" title="Global match">g</label>
        <label class="flag-label" data-flag="i" title="Case-insensitive">i</label>
        <label class="flag-label" data-flag="m" title="Multiline">m</label>
        <label class="flag-label" data-flag="s" title="Dotall">s</label>
      </div>
    </div>

    <div class="editor-wrapper">
      <textarea id="test-string" class="editor-textarea" placeholder="Enter your test string here..."></textarea>
      <div id="highlight-output" class="editor-highlight"></div>
    </div>

    <div class="results-panel" id="results-panel">
      <div class="results-header" id="results-header">Enter a pattern and text to see matches.</div>
      <div id="results-list"></div>
    </div>
    
    <div class="cheatsheet">
        <details>
            <summary>Regex Cheatsheet</summary>
            <div class="cheatsheet-content">
                <p><b>.</b> - Any character | <b>\d</b> - Digit | <b>\w</b> - Word character</p>
                <p><b>\s</b> - Whitespace | <b>\b</b> - Word boundary | <b>^</b> - Start of string</p>
                <p><b>$</b> - End of string | <b>*</b> - 0 or more | <b>+</b> - 1 or more | <b>?</b> - 0 or one</p>
                <p><b>[abc]</b> - Character set | <b>[^abc]</b> - Negated set | <b>(a|b)</b> - Or</p>
            </div>
        </details>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const regexInput = document.getElementById('regex-input');
    const testString = document.getElementById('test-string');
    const flagsContainer = document.getElementById('regex-flags');
    const resultsHeader = document.getElementById('results-header');
    const resultsList = document.getElementById('results-list');
    const highlightOutput = document.getElementById('highlight-output');
    
    const debounce = (func, delay) => {
        let timeout;
        return (...args) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), delay);
        };
    };

    function getSelectedFlags() {
        return Array.from(flagsContainer.querySelectorAll('.flag-label.active'))
                    .map(label => label.dataset.flag)
                    .join('');
    }

    function sanitize(str) {
        if (typeof str !== 'string') return '';
        return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    const updateRegex = () => {
        const pattern = regexInput.value;
        const text = testString.value;
        const flags = getSelectedFlags();

        resultsList.innerHTML = '';
        highlightOutput.innerHTML = sanitize(text);

        if (!pattern) {
            resultsHeader.textContent = 'Enter a pattern to begin.';
            return;
        }

        try {
            const regex = new RegExp(pattern, flags);
            let matchesArray = [];

            // BUG FIX: Use match() for non-global regex, and matchAll() for global regex.
            // This prevents a TypeError when 'g' flag is disabled.
            if (flags.includes('g')) {
                matchesArray = Array.from(text.matchAll(regex));
            } else {
                const singleMatch = text.match(regex);
                if (singleMatch) {
                    // Manually add the 'index' property to mimic matchAll result
                    singleMatch.index = text.indexOf(singleMatch[0]);
                    matchesArray.push(singleMatch);
                }
            }
            
            resultsHeader.textContent = `${matchesArray.length} match${matchesArray.length === 1 ? '' : 'es'} found.`;

            if (matchesArray.length > 0) {
                let highlightedHtml = '';
                let lastIndex = 0;
                
                matchesArray.forEach(match => {
                    // The main match text is always at index 0
                    const matchText = match[0];
                    // The index where the match was found
                    const matchIndex = match.index;

                    // Append the text between the last match and this one
                    highlightedHtml += sanitize(text.substring(lastIndex, matchIndex));
                    // Append the highlighted match
                    highlightedHtml += `<mark>${sanitize(matchText)}</mark>`;
                    // Update the last index pointer
                    lastIndex = matchIndex + matchText.length;
                    
                    const matchItem = document.createElement('div');
                    matchItem.className = 'match-item';
                    
                    let matchContent = `<div class="match-title">Match ${resultsList.children.length + 1} at index ${matchIndex}: <code>${sanitize(matchText) || '""'}</code></div>`;
                    if (match.length > 1) {
                        // Display capture groups (index > 0)
                        for (let i = 1; i < match.length; i++) {
                             matchContent += `<div class="match-group">Group ${i}: <code>${sanitize(match[i] === undefined ? 'undefined' : match[i])}</code></div>`;
                        }
                    }
                    matchItem.innerHTML = matchContent;
                    resultsList.appendChild(matchItem);
                });
                
                highlightedHtml += sanitize(text.substring(lastIndex));
                highlightOutput.innerHTML = highlightedHtml;
            }

        } catch (e) {
            resultsHeader.textContent = 'Invalid Regular Expression';
            resultsList.innerHTML = `<div class="error-message">${e.message}</div>`;
        }
    };

    flagsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('flag-label')) {
            e.target.classList.toggle('active');
            updateRegex();
        }
    });

    regexInput.addEventListener('input', debounce(updateRegex, 200));
    testString.addEventListener('input', debounce(updateRegex, 200));
    testString.addEventListener('scroll', () => {
        highlightOutput.scrollTop = testString.scrollTop;
        highlightOutput.scrollLeft = testString.scrollLeft;
    });

    updateRegex();
});
</script>

</body>
</html>
