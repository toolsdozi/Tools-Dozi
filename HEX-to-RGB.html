<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Real-time HEX ↔ RGB Converter</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --border-radius: 12px;
      --transition-speed: 0.3s;
      --font-main: 'Inter', sans-serif;
      --font-mono: 'Roboto Mono', monospace;
    }

    :root[data-theme='dark'] {
      --bg-start: #0F0C29; --bg-mid: #302B63; --bg-end: #24243E;
      --surface-color: rgba(30, 30, 42, 0.85);
      --border-color: rgba(255, 255, 255, 0.1);
      --primary-text-color: #F0F0F0;
      --secondary-text-color: #A0A0A0;
      --accent-start: #11998e; --accent-end: #38ef7d;
      --accent-gradient: linear-gradient(45deg, var(--accent-start), var(--accent-end));
      --accent-glow-color: rgba(56, 239, 125, 0.2);
      --shadow-color: rgba(0,0,0,0.5);
      --input-bg-color: rgba(0,0,0,0.3);
      --error-color: #ff5252;
    }

    :root[data-theme='light'] {
      --bg-start: #FDFBFB; --bg-mid: #EBEDEE; --bg-end: #FDFBFB;
      --surface-color: rgba(255, 255, 255, 0.9);
      --border-color: rgba(0, 0, 0, 0.1);
      --primary-text-color: #111;
      --secondary-text-color: #666;
      --accent-start: #11998e; --accent-end: #38ef7d;
      --accent-gradient: linear-gradient(45deg, var(--accent-start), var(--accent-end));
      --accent-glow-color: rgba(56, 239, 125, 0.3);
      --shadow-color: rgba(0,0,0,0.1);
      --input-bg-color: rgba(0,0,0,0.03);
      --error-color: #ff4444;
    }
    
    * { box-sizing: border-box; margin: 0; }
    body {
      font-family: var(--font-main);
      background: linear-gradient(-45deg, var(--bg-start), var(--bg-mid), var(--bg-end));
      background-size: 400% 400%; animation: gradientBG 15s ease infinite;
      color: var(--primary-text-color); display: flex; justify-content: center;
      align-items: center; min-height: 100vh; padding: 1.5rem;
    }
    @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

    .container {
      width: 100%; max-width: 600px;
      background: var(--surface-color); backdrop-filter: blur(25px);
      border: 1px solid var(--border-color); border-radius: 20px;
      padding: 2rem; box-shadow: 0 20px 60px var(--shadow-color);
    }
    
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
    h1 { font-size: 1.8rem; }
    
    .converter-layout { display: flex; flex-direction: column; gap: 2rem; }

    .preview-panel { display: flex; gap: 1.5rem; align-items: center; }
    .color-preview { width: 80px; height: 80px; border-radius: var(--border-radius); border: 2px solid var(--border-color); flex-shrink: 0; }
    .hex-panel { width: 100%; }
    
    .input-group { position: relative; }
    .input-group label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--secondary-text-color); }
    .input-group .input-field {
        width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px;
        background: var(--input-bg-color); color: var(--primary-text-color);
        font-family: var(--font-mono); font-size: 1.2rem; outline: none; transition: all var(--transition-speed);
    }
    .input-group .input-field:focus { border-color: var(--accent-start); box-shadow: 0 0 10px var(--accent-glow-color); }
    .copy-btn {
        position: absolute; right: 0.5rem; top: 50%; transform: translateY(15%);
        background: none; border: none; color: var(--secondary-text-color); cursor: pointer;
        padding: 0.5rem;
    }
    .copy-btn:hover { color: var(--primary-text-color); }

    .rgb-panel h2 { font-size: 1.2rem; margin-bottom: 1rem; }
    .slider-group { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    .slider-group label { width: 20px; text-align: center; font-weight: bold; }
    .slider-group input[type="range"] { flex: 1; -webkit-appearance: none; appearance: none; height: 8px; border-radius: 4px; background: #ddd; outline: none; padding: 0; }
    .slider-group input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: white; border: 3px solid var(--accent-start); cursor: pointer; margin-top: -6px; }
    .slider-group input[type="range"]::-moz-range-thumb { width: 14px; height: 14px; border-radius: 50%; background: white; border: 3px solid var(--accent-start); cursor: pointer; }
    .slider-group input[type="number"] { width: 70px; text-align: center; }
    input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }

    .toast {
      position: fixed; bottom: 2rem; left: 50%;
      transform: translateX(-50%) translateY(200%);
      padding: 1rem 1.5rem; border-radius: 8px; font-weight: 500;
      color: #fff; background: #333; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.4s ease-in-out; z-index: 1001;
    }
    .toast.show { transform: translateX(-50%) translateY(0); }

    @media (min-width: 600px) {
        .converter-layout { flex-direction: row; align-items: flex-start; }
        .preview-panel { flex-direction: column; align-items: stretch; text-align: center; flex-basis: 300px; }
        .rgb-panel { flex: 1; }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
        <h1>HEX ↔ RGB Converter</h1>
    </div>
    <div class="converter-layout">
        <div class="preview-panel">
            <div class="color-preview" id="color-preview"></div>
            <div class="hex-panel">
                 <div class="input-group">
                    <label for="hex-input">HEX</label>
                    <input type="text" id="hex-input" class="input-field">
                    <button class="copy-btn" id="copy-hex" title="Copy HEX">
                        <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zM-1 1.5A1.5 1.5 0 0 1 .5 0h3A1.5 1.5 0 0 1 5 1.5v1A1.5 1.5 0 0 1 3.5 4h-3A1.5 1.5 0 0 1-1 2.5v-1z"/></svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="rgb-panel">
            <div class="input-group">
                <label>RGB</label>
                <div id="rgb-output" class="input-field" style="cursor: pointer;"></div>
            </div>
            <div class="slider-group">
                <label for="r-slider">R</label>
                <input type="range" id="r-slider" min="0" max="255"><input type="number" id="r-input" class="input-field" min="0" max="255">
            </div>
            <div class="slider-group">
                <label for="g-slider">G</label>
                <input type="range" id="g-slider" min="0" max="255"><input type="number" id="g-input" class="input-field" min="0" max="255">
            </div>
            <div class="slider-group">
                <label for="b-slider">B</label>
                <input type="range" id="b-slider" min="0" max="255"><input type="number" id="b-input" class="input-field" min="0" max="255">
            </div>
        </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const elements = {
        preview: document.getElementById('color-preview'),
        hexInput: document.getElementById('hex-input'),
        rgbOutput: document.getElementById('rgb-output'),
        rSlider: document.getElementById('r-slider'), rInput: document.getElementById('r-input'),
        gSlider: document.getElementById('g-slider'), gInput: document.getElementById('g-input'),
        bSlider: document.getElementById('b-slider'), bInput: document.getElementById('b-input'),
        copyHexBtn: document.getElementById('copy-hex'),
    };

    let sourceOfUpdate = null;

    const rgbToHex = (r, g, b) => '#' + [r, g, b].map(x => Math.round(x).toString(16).padStart(2, '0')).join('');
    const hexToRgb = (hex) => {
        if (!/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) return null;
        let c = hex.substring(1).split('');
        if (c.length === 3) { c = [c[0], c[0], c[1], c[1], c[2], c[2]]; }
        c = '0x' + c.join('');
        return { r: (c >> 16) & 255, g: (c >> 8) & 255, b: c & 255 };
    };

    const debounce = (func, delay) => {
        let timeout;
        return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); };
    };

    const showToast = (message) => {
        const existingToast = document.querySelector('.toast');
        if (existingToast) existingToast.remove();
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 500); }, 2000);
    }
    
    const updateFromHex = () => {
        if (sourceOfUpdate === 'hex') return;
        sourceOfUpdate = 'hex';
        const rgb = hexToRgb(elements.hexInput.value);
        if (rgb) {
            elements.hexInput.style.borderColor = '';
            updateUI(rgb.r, rgb.g, rgb.b);
        } else {
            elements.hexInput.style.borderColor = 'var(--error-color)';
        }
        sourceOfUpdate = null;
    };

    const updateFromRgb = () => {
        if (sourceOfUpdate === 'rgb') return;
        sourceOfUpdate = 'rgb';
        
        // BUG FIX: Validate and clamp RGB values between 0 and 255
        const clamp = (val) => Math.min(255, Math.max(0, parseInt(val || 0, 10)));
        const r = clamp(elements.rInput.value);
        const g = clamp(elements.gInput.value);
        const b = clamp(elements.bInput.value);

        updateUI(r, g, b);
        sourceOfUpdate = null;
    };

    const updateUI = (r, g, b) => {
        const hex = rgbToHex(r, g, b);

        if (sourceOfUpdate !== 'hex') {
            elements.hexInput.value = hex.toUpperCase();
            if (elements.hexInput.style.borderColor) elements.hexInput.style.borderColor = '';
        }
        
        elements.rgbOutput.textContent = `rgb(${r}, ${g}, ${b})`;
        elements.preview.style.backgroundColor = hex;

        if (sourceOfUpdate !== 'rgb') {
            elements.rInput.value = r; elements.rSlider.value = r;
            elements.gInput.value = g; elements.gSlider.value = g;
            elements.bInput.value = b; elements.bSlider.value = b;
        }

        elements.rSlider.style.background = `linear-gradient(to right, rgb(0, ${g}, ${b}), rgb(255, ${g}, ${b}))`;
        elements.gSlider.style.background = `linear-gradient(to right, rgb(${r}, 0, ${b}), rgb(${r}, 255, ${b}))`;
        elements.bSlider.style.background = `linear-gradient(to right, rgb(${r}, ${g}, 0), rgb(${r}, ${g}, 255))`;
    };
    
    elements.hexInput.addEventListener('input', debounce(updateFromHex, 250));

    ['r', 'g', 'b'].forEach(c => {
        const input = elements[`${c}Input`], slider = elements[`${c}Slider`];
        input.addEventListener('input', () => { slider.value = input.value; debounce(updateFromRgb, 200)(); });
        input.addEventListener('change', () => { // Ensure value is clamped when user leaves the input
             if(parseInt(input.value) > 255) input.value = 255;
             if(parseInt(input.value) < 0 || !input.value) input.value = 0;
             updateFromRgb();
        });
        slider.addEventListener('input', () => { input.value = slider.value; updateFromRgb(); });
    });

    const copyWithFeedback = (btn, text) => {
        navigator.clipboard.writeText(text);
        showToast('Copied!');
        const originalIcon = btn.innerHTML;
        btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/></svg>';
        setTimeout(() => { btn.innerHTML = originalIcon; }, 2000);
    }

    elements.copyHexBtn.addEventListener('click', () => copyWithFeedback(elements.copyHexBtn, elements.hexInput.value));
    elements.rgbOutput.addEventListener('click', () => {
        navigator.clipboard.writeText(elements.rgbOutput.textContent);
        showToast('Copied!');
    });

    updateUI(22, 160, 133);
});
</script>

</body>
</html>
