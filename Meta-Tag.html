<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced On-Page SEO Audit Tool</title>
  <style>
    :root {
      --primary-color: #1a73e8; --text-color: #3c4043; --bg-color: #f8f9fa;
      --border-color: #dadce0; --card-bg: #fff; --success-color: #1e8e3e; --warn-color: #f9ab00;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Roboto", "Segoe UI", Helvetica, Arial, sans-serif;
      background-color: var(--bg-color); margin: 0; padding: 20px;
    }
    .container {
      max-width: 1200px; margin: 20px auto;
    }
    h2 { text-align: center; color: var(--text-color); margin: 0 0 20px 0; font-size: 2em; }
    
    .input-card {
      background: var(--card-bg); padding: 25px; border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 30px;
    }
    .input-group { display: flex; gap: 10px; }
    #urlInput {
      flex-grow: 1; padding: 14px; border-radius: 8px; border: 1px solid var(--border-color);
      font-size: 16px;
    }
    #analyzeButton {
      padding: 14px 28px; background-color: var(--primary-color); color: white;
      border-radius: 8px; border: none; font-size: 16px; cursor: pointer; transition: all 0.2s ease;
      font-weight: 500;
    }
    #analyzeButton:disabled { background-color: #99c1f9; cursor: not-allowed; }
    #analyzeButton:hover:not(:disabled) { background-color: #185abc; }

    /* NEW: Dashboard Layout */
    .dashboard {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      align-items: flex-start;
    }
    @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr; } }
    
    /* NEW: SERP Preview Component */
    .serp-preview-card {
      background: var(--card-bg); padding: 20px; border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .serp-preview-card h3 { margin: 0 0 15px 0; }
    .serp-result {
      font-family: Arial, sans-serif; background: #fff; padding: 15px; border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    .serp-url { font-size: 14px; color: #202124; word-break: break-all; }
    .serp-title { font-size: 20px; color: #1a0dab; font-weight: 400; line-height: 1.3; margin: 2px 0 3px 0; }
    .serp-description { font-size: 14px; color: #4d5156; line-height: 1.57; }
    
    /* NEW: Accordion for Analysis Results */
    .analysis-card {
      background: var(--card-bg); border-radius: 12px; overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .accordion-item { border-bottom: 1px solid var(--border-color); }
    .accordion-item:last-child { border-bottom: none; }
    .accordion-header {
      width: 100%; background: #fff; border: none; text-align: left; padding: 18px 20px;
      font-size: 18px; font-weight: 500; cursor: pointer; display: flex; justify-content: space-between;
      align-items: center;
    }
    .accordion-header::after { content: '▼'; font-size: 12px; transition: transform 0.2s; }
    .accordion-header.active::after { transform: rotate(180deg); }
    .accordion-content {
      padding: 0 20px 20px 20px; max-height: 0; overflow: hidden;
      transition: max-height 0.3s ease-out, padding 0.3s ease-out;
    }
    .result-item { margin-bottom: 10px; line-height: 1.5; }
    .result-item strong { min-width: 110px; display: inline-block; }
    .length-feedback { font-size: 0.9em; margin-left: 8px; font-weight: bold; }
    .ok { color: var(--success-color); }
    .warn { color: var(--warn-color); }
    
    .loader, .error { text-align: center; padding: 20px; font-weight: 500; }
    .error { color: #d93025; }
  </style>
</head>
<body>

<div class="container">
    <h2>Advanced On-Page SEO Audit Tool</h2>
    <div class="input-card">
        <div class="input-group">
            <input type="url" id="urlInput" placeholder="e.g., https://google.com">
            <button id="analyzeButton">Audit</button>
        </div>
    </div>

    <div id="loader" class="loader" style="display:none;">Auditing Page... This may take a moment.</div>
    <div id="error" class="error" style="display:none;"></div>
    
    <div id="resultDashboard" class="dashboard" style="display:none;">
        <div class="serp-preview-card">
            <h3>Google Search Preview</h3>
            <div id="serpPreview" class="serp-result"></div>
        </div>
        <div class="analysis-card" id="analysisAccordion">
            </div>
    </div>
</div>

<script>
// --- DOM ELEMENTS ---
const urlInput = document.getElementById('urlInput');
const analyzeButton = document.getElementById('analyzeButton');
const loader = document.getElementById('loader');
const errorEl = document.getElementById('error');
const resultDashboard = document.getElementById('resultDashboard');
const serpPreview = document.getElementById('serpPreview');
const analysisAccordion = document.getElementById('analysisAccordion');

// --- CORE LOGIC ---
async function runAudit() {
    let url = urlInput.value.trim();
    if (!url) { showError('Please enter a URL.'); return; }
    if (!url.startsWith('http')) { url = `https://${url}`; urlInput.value = url; }

    // --- Reset UI ---
    loader.style.display = 'block';
    resultDashboard.style.display = 'none';
    errorEl.style.display = 'none';
    analyzeButton.disabled = true;

    try {
        const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
        if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        if (!doc.querySelector('title') && doc.querySelectorAll('meta').length < 2) {
            throw new Error("The content does not appear to be a valid HTML page.");
        }

        // --- Run all analyses ---
        const metaAnalysis = analyzeMeta(doc);
        const headingAnalysis = analyzeHeadings(doc);
        const imageAnalysis = analyzeImages(doc);

        // --- Display results ---
        displaySerpPreview(metaAnalysis.title, url, metaAnalysis.description);
        displayAnalysisAccordion(metaAnalysis, headingAnalysis, imageAnalysis);
        resultDashboard.style.display = 'grid';

    } catch (error) {
        console.error("Audit Error:", error);
        showError(error.message || "Failed to fetch or audit the URL. The site may be blocking bots, or the URL is incorrect.");
    } finally {
        loader.style.display = 'none';
        analyzeButton.disabled = false;
    }
}

// --- ANALYSIS MODULES ---
function analyzeMeta(doc) {
    const get = (selector, attribute) => doc.querySelector(selector)?.getAttribute(attribute) || 'Not found';
    const title = doc.querySelector('title')?.innerText || 'Not found';
    const description = get('meta[name="description"]', 'content');
    return {
        title,
        titleLength: title.length,
        description,
        descriptionLength: description.length,
        ogTitle: get('meta[property="og:title"]', 'content'),
        ogDescription: get('meta[property="og:description"]', 'content'),
        canonical: get('link[rel="canonical"]', 'href')
    };
}

function analyzeHeadings(doc) {
    const headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];
    const results = {};
    headings.forEach(h => {
        results[h] = Array.from(doc.querySelectorAll(h)).map(el => el.innerText.trim());
    });
    return results;
}

function analyzeImages(doc) {
    const images = doc.querySelectorAll('img');
    const total = images.length;
    const missingAlt = Array.from(images).filter(img => !img.alt?.trim()).length;
    return { total, missingAlt };
}

// --- UI DISPLAY FUNCTIONS ---
function displaySerpPreview(title, url, description) {
    // Simulate Google's truncation
    const displayUrl = url.replace(/^(?:https?:\/\/)?(?:www\.)?/i, "").split('/')[0];
    const truncatedTitle = title.length > 60 ? title.slice(0, 60) + '...' : title;
    const truncatedDesc = description.length > 160 ? description.slice(0, 160) + '...' : description;
    
    serpPreview.innerHTML = `
        <div class="serp-url">${displayUrl}</div>
        <h3 class="serp-title">${truncatedTitle}</h3>
        <p class="serp-description">${truncatedDesc}</p>
    `;
}

function displayAnalysisAccordion(meta, headings, images) {
    // --- Feedback Logic ---
    const titleFeedback = getLengthFeedback(meta.titleLength, 50, 60);
    const descFeedback = getLengthFeedback(meta.descriptionLength, 140, 160);
    const h1Feedback = headings.h1.length === 1 ? `<span class="ok">✓ Good (1 found)</span>` : `<span class="warn">⚠ Warning (${headings.h1.length} found)</span>`;
    const imgFeedback = images.missingAlt === 0 ? `<span class="ok">✓ Good</span>` : `<span class="warn">⚠ ${images.missingAlt} missing</span>`;

    analysisAccordion.innerHTML = `
        <div class="accordion-item">
            <button class="accordion-header active">Core Meta Analysis</button>
            <div class="accordion-content" style="max-height: 500px;">
                <div class="result-item"><strong>Title:</strong> ${meta.title} <span class="length-feedback ${titleFeedback.class}">${titleFeedback.text}</span></div>
                <div class="result-item"><strong>Description:</strong> ${meta.description} <span class="length-feedback ${descFeedback.class}">${descFeedback.text}</span></div>
                <div class="result-item"><strong>Canonical URL:</strong> ${meta.canonical}</div>
            </div>
        </div>
        <div class="accordion-item">
            <button class="accordion-header">Heading Structure</button>
            <div class="accordion-content">
                <div class="result-item"><strong>&lt;h1&gt; Count:</strong> ${h1Feedback}</div>
                ${headings.h1.map(h => `<div style="padding-left:15px;color:#666;">- ${h}</div>`).join('')}
                <div class="result-item"><strong>&lt;h2&gt; Count:</strong> ${headings.h2.length}</div>
                <div class="result-item"><strong>&lt;h3&gt; Count:</strong> ${headings.h3.length}</div>
            </div>
        </div>
        <div class="accordion-item">
            <button class="accordion-header">Image SEO</button>
            <div class="accordion-content">
                <div class="result-item"><strong>Total Images Found:</strong> ${images.total}</div>
                <div class="result-item"><strong>Images Missing Alt Text:</strong> ${imgFeedback}</div>
            </div>
        </div>
        <div class="accordion-item">
            <button class="accordion-header">Social Tags (Open Graph)</button>
            <div class="accordion-content">
                <div class="result-item"><strong>og:title:</strong> ${meta.ogTitle}</div>
                <div class="result-item"><strong>og:description:</strong> ${meta.ogDescription}</div>
            </div>
        </div>
    `;
    
    // Add event listeners to new accordion headers
    document.querySelectorAll('.accordion-header').forEach(button => {
        button.addEventListener('click', () => {
            const content = button.nextElementSibling;
            button.classList.toggle('active');
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    });
}

function getLengthFeedback(len, min, max) {
    if (len >= min && len <= max) return { class: 'ok', text: `✓ ${len} chars` };
    if (len === 0) return { class: 'warn', text: `⚠ Missing` };
    return { class: 'warn', text: `⚠ ${len} chars (Ideal: ${min}-${max})` };
}

function showError(message) {
    errorEl.textContent = message;
    errorEl.style.display = 'block';
}

// --- EVENT LISTENERS ---
analyzeButton.addEventListener('click', runAudit);
urlInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') runAudit(); });

</script>
</body>
</html>
